import{j as e}from"./ui-D8yO-OxE.js";import{r as h,u as $,i as R}from"./vendor-XhsmhKu1.js";import{s as n,v as x,C as G,b as V,d as H,e as W,B as F,i as J,f as K}from"./index-DRBMqcxT.js";import{I as i}from"./input-O-h5M17i.js";import{T as z,N as Y}from"./textarea-B-Q9Uetu.js";import{L as o}from"./label-ByQLJlol.js";import{S as v,a as b,b as N,c as w,d as S}from"./select-D0pEHiDr.js";import{S as Q}from"./switch-Cl93K1DX.js";import{E as X}from"./EnhancedFileUpload-xuzDVd9Q.js";import{U as Z}from"./users-B0SoK6Bo.js";import{S as ee}from"./save-C9ClsOGX.js";import"./dialog--irBdw-G.js";import"./loader-2-_jRFAYkw.js";import"./zap-HGA0vdNu.js";import"./rotate-ccw-DV9cG8Qf.js";import"./file-text-Btezo_YE.js";const Ee=()=>{const[t,f]=h.useState({employee_id:"",first_name:"",last_name:"",email:"",phone:"",position:"",station:"",hire_date:"",salary:0,is_active:!0,date_of_birth:"",current_address:"",mailing_address:"",reference_name:"",id_document_type:"",id_document_file_id:null}),[l,A]=h.useState(null),[D,q]=h.useState(!1),[k,g]=h.useState(!1),[m,O]=h.useState(!1),_=$(),{id:E}=R(),P=["MOBIL","AMOCO ROSEDALE","AMOCO BROOKLYN"],M=["Manager","Supervisor","Cashier","Attendant","Mechanic","Cleaner"],T=["Driving License","Passport","Green Card","SSN","Work Permit"];h.useEffect(()=>{E?(O(!0),U(parseInt(E))):C()},[E]);const C=async()=>{try{const{data:a,error:r}=await n.from("employees").select("employee_id").ilike("employee_id","DFS%").order("employee_id",{ascending:!1}).limit(1e3);if(r)throw console.error("Error fetching existing employee IDs:",r),r;let p=1001;if(a&&a.length>0){const c=a.map(u=>{const I=u.employee_id.match(/^DFS(\d+)$/);return I?parseInt(I[1]):0}).filter(u=>u>0);c.length>0&&(p=Math.max(...c)+1)}const s=`DFS${p}`,{data:j,error:y}=await n.from("employees").select("employee_id").eq("employee_id",s).limit(1);if(y)throw console.error("Error checking employee ID uniqueness:",y),y;if(j&&j.length>0){const c=`DFS${p+1}`;f(u=>({...u,employee_id:c})),console.log("Generated unique employee ID (fallback):",c)}else f(c=>({...c,employee_id:s})),console.log("Generated unique employee ID:",s)}catch(a){console.error("Error generating employee ID:",a),x({title:"Warning",description:"Could not auto-generate employee ID. Please enter manually.",variant:"default"})}},U=async a=>{try{g(!0);const{data:r,error:p}=await n.from("employees").select("*").eq("ID",a).limit(1).single();if(p)throw p;if(r){const s=r;f({employee_id:s.employee_id||"",first_name:s.first_name||"",last_name:s.last_name||"",email:s.email||"",phone:s.phone||"",position:s.position||"",station:s.station||"",hire_date:s.hire_date?s.hire_date.split("T")[0]:"",salary:s.salary||0,is_active:s.is_active!==!1,date_of_birth:s.date_of_birth?s.date_of_birth.split("T")[0]:"",current_address:s.current_address||"",mailing_address:s.mailing_address||"",reference_name:s.reference_name||"",id_document_type:s.id_document_type||"",id_document_file_id:s.id_document_file_id||null})}}catch(r){console.error("Error loading employee:",r),x({title:"Error",description:"Failed to load employee details",variant:"destructive"})}finally{g(!1)}},L=async()=>{if(!l)return null;q(!0);try{const a=l.name.split(".").pop(),r=`${Date.now()}_${Math.random().toString(36).substring(2)}.${a}`,{data:p,error:s}=await n.storage.from("documents").upload(r,l);if(s)throw s;const{data:j,error:y}=await n.from("files").insert({filename:l.name,storage_path:p.path,file_size:l.size,mime_type:l.type,uploaded_at:new Date().toISOString()}).select("id").single();if(y)throw y;return j.id}catch(a){return console.error("Error uploading file:",a),x({title:"Error",description:"Failed to upload file. Please try again.",variant:"destructive"}),null}finally{q(!1)}},B=async a=>{a.preventDefault();try{g(!0);let r=t.id_document_file_id;if(l&&(r=await L(),r===null)){g(!1);return}const p={...t,hire_date:t.hire_date?new Date(t.hire_date).toISOString():"",date_of_birth:t.date_of_birth?new Date(t.date_of_birth).toISOString():"",id_document_file_id:r,created_by:1};if(m&&E){const{error:s}=await n.from("employees").update(p).eq("ID",parseInt(E));if(s)throw s;x({title:"Success",description:"Employee updated successfully"})}else{const{error:s}=await n.from("employees").insert(p);if(s)throw s;x({title:"Success",description:"Employee created successfully"})}_("/employees")}catch(r){console.error("Error saving employee:",r),x({title:"Error",description:`Failed to ${m?"update":"create"} employee`,variant:"destructive"})}finally{g(!1)}},d=(a,r)=>{f(p=>({...p,[a]:r}))};return e.jsx("div",{className:"space-y-6","data-id":"r8kna9wld","data-path":"src/pages/Employees/EmployeeForm.tsx",children:e.jsxs(G,{"data-id":"zz646kdsk","data-path":"src/pages/Employees/EmployeeForm.tsx",children:[e.jsx(V,{"data-id":"ahnf43nwc","data-path":"src/pages/Employees/EmployeeForm.tsx",children:e.jsxs("div",{className:"flex items-center justify-between","data-id":"w23g8q7er","data-path":"src/pages/Employees/EmployeeForm.tsx",children:[e.jsxs("div",{"data-id":"b6pn8ij6a","data-path":"src/pages/Employees/EmployeeForm.tsx",children:[e.jsxs(H,{className:"flex items-center space-x-2","data-id":"8vhgprhn4","data-path":"src/pages/Employees/EmployeeForm.tsx",children:[e.jsx(Z,{className:"w-6 h-6","data-id":"elt3t2e5m","data-path":"src/pages/Employees/EmployeeForm.tsx"}),e.jsx("span",{"data-id":"ai0xl2y8b","data-path":"src/pages/Employees/EmployeeForm.tsx",children:m?"Edit Employee":"Add New Employee"})]}),e.jsx(W,{"data-id":"a38tuknlu","data-path":"src/pages/Employees/EmployeeForm.tsx",children:m?"Update employee information":"Add a new employee to your team"})]}),e.jsxs(F,{variant:"outline",onClick:()=>_("/employees"),"data-id":"rre573m7n","data-path":"src/pages/Employees/EmployeeForm.tsx",children:[e.jsx(J,{className:"w-4 h-4 mr-2","data-id":"f6ephe5ks","data-path":"src/pages/Employees/EmployeeForm.tsx"}),"Back to Employees"]})]})}),e.jsx(K,{"data-id":"ynrudii9q","data-path":"src/pages/Employees/EmployeeForm.tsx",children:e.jsxs("form",{onSubmit:B,className:"space-y-8","data-id":"c5e7pmh5v","data-path":"src/pages/Employees/EmployeeForm.tsx",children:[e.jsxs("div",{"data-id":"bbbgdjsut","data-path":"src/pages/Employees/EmployeeForm.tsx",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-900","data-id":"36fgvly4c","data-path":"src/pages/Employees/EmployeeForm.tsx",children:"Basic Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6","data-id":"69il4k7cd","data-path":"src/pages/Employees/EmployeeForm.tsx",children:[e.jsxs("div",{className:"space-y-2","data-id":"qmd2de80x","data-path":"src/pages/Employees/EmployeeForm.tsx",children:[e.jsx(o,{htmlFor:"employee_id","data-id":"v58x0pcjm","data-path":"src/pages/Employees/EmployeeForm.tsx",children:"Employee ID *"}),e.jsxs("div",{className:"flex items-center space-x-2","data-id":"1jybh030t","data-path":"src/pages/Employees/EmployeeForm.tsx",children:[e.jsx(i,{id:"employee_id",value:t.employee_id,onChange:a=>d("employee_id",a.target.value),placeholder:m?"Enter employee ID":"Auto-generated",readOnly:!m,className:m?"":"bg-gray-50 cursor-not-allowed",required:!0,"data-id":"skixncigk","data-path":"src/pages/Employees/EmployeeForm.tsx"}),!m&&e.jsx(F,{type:"button",variant:"outline",size:"sm",onClick:C,className:"shrink-0","data-id":"du62433nf","data-path":"src/pages/Employees/EmployeeForm.tsx",children:"Regenerate"})]}),!m&&e.jsx("p",{className:"text-xs text-gray-500","data-id":"45wi9b9zq","data-path":"src/pages/Employees/EmployeeForm.tsx",children:"Auto-generated format: DFS#### (sequential numbering starting from DFS1001)"})]}),e.jsxs("div",{className:"space-y-2","data-id":"j8ompj6d0","data-path":"src/pages/Employees/EmployeeForm.tsx",children:[e.jsx(o,{htmlFor:"station","data-id":"rj8nlb22f","data-path":"src/pages/Employees/EmployeeForm.tsx",children:"Station *"}),e.jsxs(v,{value:t.station,onValueChange:a=>d("station",a),"data-id":"tuc4pob3v","data-path":"src/pages/Employees/EmployeeForm.tsx",children:[e.jsx(b,{"data-id":"ky5zadqo6","data-path":"src/pages/Employees/EmployeeForm.tsx",children:e.jsx(N,{placeholder:"Select station","data-id":"x675q7mtg","data-path":"src/pages/Employees/EmployeeForm.tsx"})}),e.jsx(w,{"data-id":"8ovqeebx4","data-path":"src/pages/Employees/EmployeeForm.tsx",children:P.map(a=>e.jsx(S,{value:a,"data-id":"pfem5hb86","data-path":"src/pages/Employees/EmployeeForm.tsx",children:a},a))})]})]}),e.jsxs("div",{className:"space-y-2","data-id":"kwghb8kne","data-path":"src/pages/Employees/EmployeeForm.tsx",children:[e.jsx(o,{htmlFor:"first_name","data-id":"68j9thoxe","data-path":"src/pages/Employees/EmployeeForm.tsx",children:"First Name *"}),e.jsx(i,{id:"first_name",value:t.first_name,onChange:a=>d("first_name",a.target.value),placeholder:"Enter first name",required:!0,"data-id":"j1qyfeuh4","data-path":"src/pages/Employees/EmployeeForm.tsx"})]}),e.jsxs("div",{className:"space-y-2","data-id":"2gwzptzzk","data-path":"src/pages/Employees/EmployeeForm.tsx",children:[e.jsx(o,{htmlFor:"last_name","data-id":"guwnb4807","data-path":"src/pages/Employees/EmployeeForm.tsx",children:"Last Name *"}),e.jsx(i,{id:"last_name",value:t.last_name,onChange:a=>d("last_name",a.target.value),placeholder:"Enter last name",required:!0,"data-id":"adfaol8jo","data-path":"src/pages/Employees/EmployeeForm.tsx"})]}),e.jsxs("div",{className:"space-y-2","data-id":"q7ip2lzzi","data-path":"src/pages/Employees/EmployeeForm.tsx",children:[e.jsx(o,{htmlFor:"date_of_birth","data-id":"upd5dju7a","data-path":"src/pages/Employees/EmployeeForm.tsx",children:"Date of Birth"}),e.jsx(i,{id:"date_of_birth",type:"date",value:t.date_of_birth,onChange:a=>d("date_of_birth",a.target.value),"data-id":"nmlrb4an5","data-path":"src/pages/Employees/EmployeeForm.tsx"})]}),e.jsxs("div",{className:"space-y-2","data-id":"ijmqhgd5u","data-path":"src/pages/Employees/EmployeeForm.tsx",children:[e.jsx(o,{htmlFor:"email","data-id":"nd2q4uzsr","data-path":"src/pages/Employees/EmployeeForm.tsx",children:"Email"}),e.jsx(i,{id:"email",type:"email",value:t.email,onChange:a=>d("email",a.target.value),placeholder:"Enter email address","data-id":"2djuhslx6","data-path":"src/pages/Employees/EmployeeForm.tsx"})]}),e.jsxs("div",{className:"space-y-2","data-id":"9pgqm2v48","data-path":"src/pages/Employees/EmployeeForm.tsx",children:[e.jsx(o,{htmlFor:"phone","data-id":"vwehzuxl7","data-path":"src/pages/Employees/EmployeeForm.tsx",children:"Phone"}),e.jsx(i,{id:"phone",value:t.phone,onChange:a=>d("phone",a.target.value),placeholder:"Enter phone number","data-id":"7dmj6s1c9","data-path":"src/pages/Employees/EmployeeForm.tsx"})]}),e.jsxs("div",{className:"space-y-2","data-id":"pocqtvaty","data-path":"src/pages/Employees/EmployeeForm.tsx",children:[e.jsx(o,{htmlFor:"reference_name","data-id":"z6d2kmye9","data-path":"src/pages/Employees/EmployeeForm.tsx",children:"Reference Name"}),e.jsx(i,{id:"reference_name",value:t.reference_name,onChange:a=>d("reference_name",a.target.value),placeholder:"Enter reference name","data-id":"cbhxp0xii","data-path":"src/pages/Employees/EmployeeForm.tsx"})]})]})]}),e.jsxs("div",{"data-id":"edc3yprkp","data-path":"src/pages/Employees/EmployeeForm.tsx",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-900","data-id":"4cz0355pp","data-path":"src/pages/Employees/EmployeeForm.tsx",children:"Address Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6","data-id":"0ljustgac","data-path":"src/pages/Employees/EmployeeForm.tsx",children:[e.jsxs("div",{className:"space-y-2","data-id":"1v25ua5rh","data-path":"src/pages/Employees/EmployeeForm.tsx",children:[e.jsx(o,{htmlFor:"current_address","data-id":"cphf6k4xo","data-path":"src/pages/Employees/EmployeeForm.tsx",children:"Current Address"}),e.jsx(z,{id:"current_address",value:t.current_address,onChange:a=>d("current_address",a.target.value),placeholder:"Enter current address",rows:3,"data-id":"ojzsr6ir7","data-path":"src/pages/Employees/EmployeeForm.tsx"})]}),e.jsxs("div",{className:"space-y-2","data-id":"bjgr0zyzu","data-path":"src/pages/Employees/EmployeeForm.tsx",children:[e.jsx(o,{htmlFor:"mailing_address","data-id":"1tn9qtn6l","data-path":"src/pages/Employees/EmployeeForm.tsx",children:"Mailing Address"}),e.jsx(z,{id:"mailing_address",value:t.mailing_address,onChange:a=>d("mailing_address",a.target.value),placeholder:"Enter mailing address",rows:3,"data-id":"55dqh16s5","data-path":"src/pages/Employees/EmployeeForm.tsx"})]})]})]}),e.jsxs("div",{"data-id":"7xmfwzkc7","data-path":"src/pages/Employees/EmployeeForm.tsx",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-900","data-id":"baj9axi2j","data-path":"src/pages/Employees/EmployeeForm.tsx",children:"Employment Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6","data-id":"ixblw7qg7","data-path":"src/pages/Employees/EmployeeForm.tsx",children:[e.jsxs("div",{className:"space-y-2","data-id":"zc5xsmngj","data-path":"src/pages/Employees/EmployeeForm.tsx",children:[e.jsx(o,{htmlFor:"position","data-id":"r53ce40b3","data-path":"src/pages/Employees/EmployeeForm.tsx",children:"Position *"}),e.jsxs(v,{value:t.position,onValueChange:a=>d("position",a),"data-id":"doinlk8rq","data-path":"src/pages/Employees/EmployeeForm.tsx",children:[e.jsx(b,{"data-id":"qgfk0oys8","data-path":"src/pages/Employees/EmployeeForm.tsx",children:e.jsx(N,{placeholder:"Select position","data-id":"f8m31eo8x","data-path":"src/pages/Employees/EmployeeForm.tsx"})}),e.jsx(w,{"data-id":"1xl4sh693","data-path":"src/pages/Employees/EmployeeForm.tsx",children:M.map(a=>e.jsx(S,{value:a,"data-id":"g4f38adc1","data-path":"src/pages/Employees/EmployeeForm.tsx",children:a},a))})]})]}),e.jsxs("div",{className:"space-y-2","data-id":"h84qguna7","data-path":"src/pages/Employees/EmployeeForm.tsx",children:[e.jsx(o,{htmlFor:"hire_date","data-id":"v89bq90up","data-path":"src/pages/Employees/EmployeeForm.tsx",children:"Hire Date"}),e.jsx(i,{id:"hire_date",type:"date",value:t.hire_date,onChange:a=>d("hire_date",a.target.value),"data-id":"fsjhthg1d","data-path":"src/pages/Employees/EmployeeForm.tsx"})]}),e.jsxs("div",{className:"space-y-2","data-id":"593pq50x5","data-path":"src/pages/Employees/EmployeeForm.tsx",children:[e.jsx(o,{htmlFor:"salary","data-id":"3wqis3h19","data-path":"src/pages/Employees/EmployeeForm.tsx",children:"Salary ($)"}),e.jsx(Y,{id:"salary",step:"0.01",min:"0",value:t.salary,onChange:a=>d("salary",a),"data-id":"ywji2syt1","data-path":"src/pages/Employees/EmployeeForm.tsx"})]}),e.jsxs("div",{className:"space-y-2","data-id":"z2aljvy13","data-path":"src/pages/Employees/EmployeeForm.tsx",children:[e.jsx(o,{htmlFor:"is_active","data-id":"yky5kg359","data-path":"src/pages/Employees/EmployeeForm.tsx",children:"Active Status"}),e.jsxs("div",{className:"flex items-center space-x-2","data-id":"5uq5njmfl","data-path":"src/pages/Employees/EmployeeForm.tsx",children:[e.jsx(Q,{id:"is_active",checked:t.is_active,onCheckedChange:a=>d("is_active",a),"data-id":"0cpnctnxz","data-path":"src/pages/Employees/EmployeeForm.tsx"}),e.jsx("span",{className:"text-sm text-gray-600","data-id":"as0l1zloa","data-path":"src/pages/Employees/EmployeeForm.tsx",children:t.is_active?"Active":"Inactive"})]})]})]})]}),e.jsxs("div",{"data-id":"v27q1gmmc","data-path":"src/pages/Employees/EmployeeForm.tsx",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-900","data-id":"dhbbrdfj0","data-path":"src/pages/Employees/EmployeeForm.tsx",children:"ID Documentation"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6","data-id":"m0tyj2ys5","data-path":"src/pages/Employees/EmployeeForm.tsx",children:[e.jsxs("div",{className:"space-y-2","data-id":"4o92prohv","data-path":"src/pages/Employees/EmployeeForm.tsx",children:[e.jsx(o,{htmlFor:"id_document_type","data-id":"4z4n5twgi","data-path":"src/pages/Employees/EmployeeForm.tsx",children:"ID Document Type"}),e.jsxs(v,{value:t.id_document_type,onValueChange:a=>d("id_document_type",a),"data-id":"2tlsxqr8c","data-path":"src/pages/Employees/EmployeeForm.tsx",children:[e.jsx(b,{"data-id":"wxmjmwt9z","data-path":"src/pages/Employees/EmployeeForm.tsx",children:e.jsx(N,{placeholder:"Select ID document type","data-id":"ev6jlx2i7","data-path":"src/pages/Employees/EmployeeForm.tsx"})}),e.jsx(w,{"data-id":"kt7ajkfzc","data-path":"src/pages/Employees/EmployeeForm.tsx",children:T.map(a=>e.jsx(S,{value:a,"data-id":"wxxoxflu4","data-path":"src/pages/Employees/EmployeeForm.tsx",children:a},a))})]})]}),e.jsxs("div",{className:"space-y-2","data-id":"px72txmsf","data-path":"src/pages/Employees/EmployeeForm.tsx",children:[e.jsx(o,{"data-id":"sx4hrlcfu","data-path":"src/pages/Employees/EmployeeForm.tsx",children:"ID Document Upload"}),e.jsx(X,{onFileSelect:A,accept:".pdf,.jpg,.jpeg,.png,image/*",label:"Upload ID Document or Take Photo",currentFile:l==null?void 0:l.name,maxSize:10,allowCamera:!0,"data-id":"08ljgj7qm","data-path":"src/pages/Employees/EmployeeForm.tsx"}),l&&e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg","data-id":"tqpnbcn7q","data-path":"src/pages/Employees/EmployeeForm.tsx",children:[e.jsx("p",{className:"text-sm font-medium","data-id":"spuz1p8o8","data-path":"src/pages/Employees/EmployeeForm.tsx",children:"Selected file:"}),e.jsx("p",{className:"text-sm text-gray-600","data-id":"wd584ca1t","data-path":"src/pages/Employees/EmployeeForm.tsx",children:l.name}),e.jsx("p",{className:"text-xs text-gray-500 mt-1","data-id":"m6fifkmo0","data-path":"src/pages/Employees/EmployeeForm.tsx",children:l.type.includes("image")?"Image file selected":"Document file selected"})]}),e.jsx("p",{className:"text-xs text-gray-500","data-id":"y8huoitus","data-path":"src/pages/Employees/EmployeeForm.tsx",children:"Supported formats: PDF, JPG, PNG (Max 10MB)"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-4 pt-6 border-t","data-id":"uuox2lll2","data-path":"src/pages/Employees/EmployeeForm.tsx",children:[e.jsx(F,{type:"button",variant:"outline",onClick:()=>_("/employees"),"data-id":"holplvnex","data-path":"src/pages/Employees/EmployeeForm.tsx",children:"Cancel"}),e.jsx(F,{type:"submit",disabled:k||D,"data-id":"0fn5zuy9h","data-path":"src/pages/Employees/EmployeeForm.tsx",children:k||D?"Saving...":e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"w-4 h-4 mr-2","data-id":"tmw7n7q21","data-path":"src/pages/Employees/EmployeeForm.tsx"}),m?"Update Employee":"Create Employee"]})})]})]})})]})})};export{Ee as default};
//# sourceMappingURL=EmployeeForm-BOv74J0S.js.map
