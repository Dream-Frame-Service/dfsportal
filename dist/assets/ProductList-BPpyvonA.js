import{j as t}from"./ui-D8yO-OxE.js";import{r as l,u as wt}from"./vendor-XhsmhKu1.js";import{v as k,T as et,n as rt,o as B,p as m,q as dt,r as g,h as z,l as ct,C as ot,b as it,d as nt,B as b,f as lt,s as I,e as vt,X as Lt}from"./index-DRBMqcxT.js";import{I as yt}from"./input-O-h5M17i.js";import{u as bt}from"./AuthContext-Bo8HSNc2.js";import{D as _t}from"./databaseService-De-l3oBE.js";import{D as Ct,a as Nt,b as Dt,c as St,d as kt}from"./dialog--irBdw-G.js";import{P as F}from"./package-qSLSIT0P.js";import{A as zt}from"./arrow-right-BEMYEbP8.js";import{T as qt}from"./trending-up-rMf4iF9b.js";import{D as Mt}from"./dollar-sign-OBnb8nXG.js";import{C as $t}from"./calendar-QZkL-AVB.js";import{F as pt}from"./file-text-Btezo_YE.js";import{L as Y}from"./loader-2-_jRFAYkw.js";import{S as ut}from"./save-C9ClsOGX.js";import{T as ht}from"./trash-2-MkbbqPap.js";import{P as Tt}from"./plus-BGEVx4a3.js";import{S as It}from"./search-CuZ6-xMH.js";const Et=({isOpen:c,onClose:i,productId:r,productName:p})=>{const[j,f]=l.useState([]),[u,w]=l.useState(!1);l.useEffect(()=>{c&&r&&C()},[c,r]);const C=async()=>{try{w(!0),console.log("Loading product logs for product ID:",r);const{data:d,error:x}=await _t.tablePage("11756",{PageNo:1,PageSize:100,OrderByField:"change_date",IsAsc:!1,Filters:[{name:"product_id",op:"Equal",value:r}]});if(x)throw console.error("API error loading logs:",x),x;console.log("Loaded logs:",(d==null?void 0:d.List)||[]),f((d==null?void 0:d.List)||[])}catch(d){console.error("Error loading product logs:",d),k({title:"Error",description:`Failed to load product change logs: ${d}`,variant:"destructive"})}finally{w(!1)}},s=d=>{if(!d)return"-";try{return new Date(d).toLocaleString()}catch{return"-"}},P=(d,x)=>{if(!x||x==="")return"-";if(d.includes("price")||d==="profit_margin"){const $=parseFloat(x);if(!isNaN($))return`$${$.toFixed(2)}`}if(d.includes("date"))try{return new Date(x).toLocaleDateString()}catch{return x}return x},v=d=>{switch(d){case"last_shopping_date":return t.jsx($t,{className:"w-4 h-4","data-id":"hc2kwpyda","data-path":"src/components/ProductLogs.tsx"});case"case_price":case"unit_price":case"retail_price":return t.jsx(Mt,{className:"w-4 h-4","data-id":"cl9g91i3q","data-path":"src/components/ProductLogs.tsx"});case"unit_per_case":return t.jsx(F,{className:"w-4 h-4","data-id":"4znreyhu3","data-path":"src/components/ProductLogs.tsx"});case"profit_margin":return t.jsx(qt,{className:"w-4 h-4","data-id":"xeuod0e31","data-path":"src/components/ProductLogs.tsx"});default:return null}},q=d=>{switch(d){case"last_shopping_date":return"Last Shopping Date";case"case_price":return"Case Price";case"unit_per_case":return"Unit Per Case";case"unit_price":return"Unit Price";case"retail_price":return"Retail Price";case"profit_margin":return"Profit Margin";default:return d.replace("_"," ").replace(/\b\w/g,x=>x.toUpperCase())}},N=d=>{switch(d){case"last_shopping_date":return"bg-blue-100 text-blue-800";case"case_price":return"bg-green-100 text-green-800";case"unit_per_case":return"bg-purple-100 text-purple-800";case"unit_price":return"bg-orange-100 text-orange-800";case"retail_price":return"bg-red-100 text-red-800";case"profit_margin":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}};return t.jsx(Ct,{open:c,onOpenChange:i,"data-id":"riru1v0g2","data-path":"src/components/ProductLogs.tsx",children:t.jsxs(Nt,{className:"max-w-4xl max-h-[80vh] overflow-y-auto","data-id":"t07tjcdcm","data-path":"src/components/ProductLogs.tsx",children:[t.jsxs(Dt,{"data-id":"zecicbo1p","data-path":"src/components/ProductLogs.tsx",children:[t.jsxs(St,{className:"flex items-center space-x-2","data-id":"2kw0lyje1","data-path":"src/components/ProductLogs.tsx",children:[t.jsx(F,{className:"w-5 h-5","data-id":"0tqm973z6","data-path":"src/components/ProductLogs.tsx"}),t.jsx("span",{"data-id":"6s0lx11jg","data-path":"src/components/ProductLogs.tsx",children:"Product Change Logs"})]}),t.jsxs(kt,{"data-id":"n6ihqul3s","data-path":"src/components/ProductLogs.tsx",children:["Change history for: ",t.jsx("span",{className:"font-medium","data-id":"cleq4da3a","data-path":"src/components/ProductLogs.tsx",children:p})]})]}),t.jsx("div",{className:"mt-4","data-id":"sw9xfs0so","data-path":"src/components/ProductLogs.tsx",children:u?t.jsx("div",{className:"space-y-4","data-id":"5jcpjg805","data-path":"src/components/ProductLogs.tsx",children:[...Array(5)].map((d,x)=>t.jsx("div",{className:"h-16 bg-gray-100 rounded animate-pulse","data-id":"g970bd1vj","data-path":"src/components/ProductLogs.tsx"},x))}):j.length===0?t.jsxs("div",{className:"text-center py-8","data-id":"7yugrxnu6","data-path":"src/components/ProductLogs.tsx",children:[t.jsx(F,{className:"w-12 h-12 text-gray-400 mx-auto mb-4","data-id":"cdb8qxkju","data-path":"src/components/ProductLogs.tsx"}),t.jsx("p",{className:"text-gray-500","data-id":"u8sg253u8","data-path":"src/components/ProductLogs.tsx",children:"No change logs found for this product"}),t.jsx("p",{className:"text-sm text-gray-400 mt-2","data-id":"jq8ddkkhp","data-path":"src/components/ProductLogs.tsx",children:"Changes will appear here when product information is updated"})]}):t.jsx("div",{className:"border rounded-lg overflow-hidden","data-id":"v396cnny9","data-path":"src/components/ProductLogs.tsx",children:t.jsxs(et,{"data-id":"i7eusq3he","data-path":"src/components/ProductLogs.tsx",children:[t.jsx(rt,{"data-id":"0irube5by","data-path":"src/components/ProductLogs.tsx",children:t.jsxs(B,{"data-id":"8z8htwwqs","data-path":"src/components/ProductLogs.tsx",children:[t.jsx(m,{"data-id":"3p0gnpe49","data-path":"src/components/ProductLogs.tsx",children:"Field"}),t.jsx(m,{"data-id":"jre7lj1as","data-path":"src/components/ProductLogs.tsx",children:"Change Date"}),t.jsx(m,{"data-id":"go1ih1wcq","data-path":"src/components/ProductLogs.tsx",children:"Old Value"}),t.jsx(m,{className:"text-center","data-id":"o6h79kyqt","data-path":"src/components/ProductLogs.tsx",children:"â†’"}),t.jsx(m,{"data-id":"sqxw0lg6q","data-path":"src/components/ProductLogs.tsx",children:"New Value"})]})}),t.jsx(dt,{"data-id":"710opnlq5","data-path":"src/components/ProductLogs.tsx",children:j.map(d=>t.jsxs(B,{"data-id":"iigia2ugp","data-path":"src/components/ProductLogs.tsx",children:[t.jsx(g,{"data-id":"th8b3xny0","data-path":"src/components/ProductLogs.tsx",children:t.jsxs("div",{className:"flex items-center space-x-2","data-id":"j14l1bm8r","data-path":"src/components/ProductLogs.tsx",children:[v(d.field_name),t.jsx(z,{className:N(d.field_name),"data-id":"6muz1l9ue","data-path":"src/components/ProductLogs.tsx",children:q(d.field_name)})]})}),t.jsx(g,{className:"text-sm text-gray-600","data-id":"dvj4xrm9w","data-path":"src/components/ProductLogs.tsx",children:s(d.change_date)}),t.jsx(g,{"data-id":"azykl7sv0","data-path":"src/components/ProductLogs.tsx",children:t.jsx("span",{className:"px-2 py-1 bg-red-50 text-red-700 rounded text-sm","data-id":"sdqmonw28","data-path":"src/components/ProductLogs.tsx",children:P(d.field_name,d.old_value)})}),t.jsx(g,{className:"text-center","data-id":"ahuzhn6l6","data-path":"src/components/ProductLogs.tsx",children:t.jsx(zt,{className:"w-4 h-4 text-gray-400","data-id":"3c6qzx23v","data-path":"src/components/ProductLogs.tsx"})}),t.jsx(g,{"data-id":"t449z8zqe","data-path":"src/components/ProductLogs.tsx",children:t.jsx("span",{className:"px-2 py-1 bg-green-50 text-green-700 rounded text-sm","data-id":"8v0patywo","data-path":"src/components/ProductLogs.tsx",children:P(d.field_name,d.new_value)})})]},d.ID))})]})})})]})})},xt=({text:c,searchTerms:i,allMatch:r})=>{if(!i.length||!c)return t.jsx(t.Fragment,{children:c});const p=i.map(u=>u.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")),j=new RegExp(`(${p.join("|")})`,"gi"),f=c.split(j);return t.jsx(t.Fragment,{children:f.map((u,w)=>i.some(s=>u.toLowerCase()===s.toLowerCase())?t.jsx("span",{className:`font-semibold ${r?"bg-green-200 text-green-800":"bg-yellow-200 text-yellow-800"}`,"data-id":"tao96ib2x","data-path":"src/components/HighlightText.tsx",children:u},w):u)})},M=768,E=1024;function Ft(){const[c,i]=l.useState(()=>{if(typeof window>"u")return{isMobile:!1,isTablet:!1,isDesktop:!0,screenWidth:1920,orientation:"landscape",touchDevice:!1};const r=window.innerWidth;return{isMobile:r<M,isTablet:r>=M&&r<E,isDesktop:r>=E,screenWidth:r,orientation:window.innerHeight>window.innerWidth?"portrait":"landscape",touchDevice:"ontouchstart"in window||navigator.maxTouchPoints>0}});return l.useEffect(()=>{const r=()=>{const u=window.innerWidth,w=window.innerHeight;i({isMobile:u<M,isTablet:u>=M&&u<E,isDesktop:u>=E,screenWidth:u,orientation:w>u?"portrait":"landscape",touchDevice:"ontouchstart"in window||navigator.maxTouchPoints>0})},p=window.matchMedia(`(max-width: ${M-1}px)`),j=window.matchMedia(`(min-width: ${M}px) and (max-width: ${E-1}px)`),f=window.matchMedia("(orientation: portrait)");return p.addEventListener("change",r),j.addEventListener("change",r),f.addEventListener("change",r),window.addEventListener("resize",r),r(),()=>{p.removeEventListener("change",r),j.removeEventListener("change",r),f.removeEventListener("change",r),window.removeEventListener("resize",r)}},[]),c}function G(){const c=Ft();return{...c,showSidebar:c.isDesktop,showBottomNav:c.isMobile,compactHeader:c.isMobile||c.isTablet,stackedLayout:c.isMobile,columnsCount:c.isMobile?1:c.isTablet?2:3,tableMode:c.isMobile?"cards":"table",sidebarMode:c.isMobile?"overlay":c.isTablet?"mini":"full"}}const At=({children:c,className:i="",fallbackComponent:r})=>{const p=G();return p.isMobile&&r?t.jsx(t.Fragment,{children:r}):t.jsx("div",{className:ct("overflow-x-auto",p.isMobile&&"overflow-x-scroll",i),"data-id":"9t60y0r9q","data-path":"src/components/ResponsiveWrapper.tsx",children:c})},Rt=({children:c,className:i="",spacing:r="md"})=>{const p=G(),j={sm:"space-y-2 sm:space-y-3",md:"space-y-4 sm:space-y-6",lg:"space-y-6 sm:space-y-8"}[r],f=ct("flex flex-col",j,p.isMobile&&"px-1",i);return t.jsx("div",{className:f,"data-id":"t161ssjzg","data-path":"src/components/ResponsiveWrapper.tsx",children:c})},Ut=({products:c,searchTerm:i,onViewLogs:r,onSaveProduct:p,onDeleteProduct:j,savingProductId:f})=>{const u=s=>{if(!s)return"-";try{return new Date(s).toLocaleDateString()}catch{return"-"}},w=s=>{if(!i||!s)return{keywords:[],allMatch:!1,highlightComponent:s};const P=i.toLowerCase().trim().split(/\s+/).filter(N=>N.length>0),v=s.toLowerCase(),q=P.every(N=>v.includes(N));return{keywords:P,allMatch:q,highlightComponent:t.jsx(xt,{text:s,searchTerms:P,allMatch:q,"data-id":"58g0bt74c","data-path":"src/components/ProductCards.tsx"})}},C=s=>{if(s.unit_price&&s.retail_price&&s.retail_price>0){const P=(s.retail_price-s.unit_price)/s.retail_price*100;return{value:P,variant:P>20?"default":P>10?"secondary":"destructive"}}return null};return t.jsx("div",{className:"grid grid-cols-1 gap-4","data-id":"vcoqocbmv","data-path":"src/components/ProductCards.tsx",children:c.map(s=>{const P=C(s);return t.jsxs(ot,{className:"hover:shadow-md transition-shadow","data-id":"tkdth0ury","data-path":"src/components/ProductCards.tsx",children:[t.jsxs(it,{className:"pb-3","data-id":"uq7z5v57b","data-path":"src/components/ProductCards.tsx",children:[t.jsxs("div",{className:"flex items-start justify-between","data-id":"ngqjwvfws","data-path":"src/components/ProductCards.tsx",children:[t.jsxs("div",{className:"flex-1 min-w-0","data-id":"yui8uv297","data-path":"src/components/ProductCards.tsx",children:[t.jsx(nt,{className:"text-lg leading-tight","data-id":"4gefxa46g","data-path":"src/components/ProductCards.tsx",children:i?w(s.product_name).highlightComponent:s.product_name}),t.jsxs("div",{className:"flex items-center gap-2 mt-1","data-id":"07m0b3qxb","data-path":"src/components/ProductCards.tsx",children:[t.jsxs(z,{variant:"outline",className:"text-xs","data-id":"6igwrok4a","data-path":"src/components/ProductCards.tsx",children:["#",s.serial_number||"-"]}),t.jsx(z,{variant:"outline",className:"text-xs","data-id":"qv4tmx4tv","data-path":"src/components/ProductCards.tsx",children:i?w(s.department||"Convenience Store").highlightComponent:s.department||"Convenience Store"})]})]}),t.jsxs("div",{className:"flex items-center space-x-1 ml-2","data-id":"dkhe03wrp","data-path":"src/components/ProductCards.tsx",children:[t.jsx(b,{variant:"outline",size:"sm",onClick:()=>r(s.ID,s.product_name),className:"p-2",title:"View logs","data-id":"eo88gx6p9","data-path":"src/components/ProductCards.tsx",children:t.jsx(pt,{className:"w-4 h-4","data-id":"23l7w9v0h","data-path":"src/components/ProductCards.tsx"})}),t.jsx(b,{variant:"outline",size:"sm",onClick:()=>p(s.ID),disabled:f===s.ID,className:"p-2",title:"Save product","data-id":"wy9upx6j1","data-path":"src/components/ProductCards.tsx",children:f===s.ID?t.jsx(Y,{className:"w-4 h-4 animate-spin","data-id":"cpi13a2im","data-path":"src/components/ProductCards.tsx"}):t.jsx(ut,{className:"w-4 h-4","data-id":"56qwhn9hs","data-path":"src/components/ProductCards.tsx"})}),t.jsx(b,{variant:"outline",size:"sm",onClick:()=>j(s.ID),className:"p-2 text-red-600 hover:text-red-700",title:"Delete product","data-id":"ll1ytnsax","data-path":"src/components/ProductCards.tsx",children:t.jsx(ht,{className:"w-4 h-4","data-id":"znbcibmod","data-path":"src/components/ProductCards.tsx"})})]})]}),s.description&&t.jsx("p",{className:"text-sm text-gray-600 mt-2 line-clamp-2","data-id":"8mdo5s8fb","data-path":"src/components/ProductCards.tsx",children:i?w(s.description).highlightComponent:s.description})]}),t.jsxs(lt,{className:"space-y-3","data-id":"w5zeaa2gx","data-path":"src/components/ProductCards.tsx",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm","data-id":"zjkp7xddy","data-path":"src/components/ProductCards.tsx",children:[t.jsxs("div",{"data-id":"i32gsz0q6","data-path":"src/components/ProductCards.tsx",children:[t.jsx("span",{className:"text-gray-500","data-id":"0h7r2acdd","data-path":"src/components/ProductCards.tsx",children:"Unit Price:"}),t.jsx("div",{className:"font-medium","data-id":"cr4jora7q","data-path":"src/components/ProductCards.tsx",children:s.unit_price?`$${s.unit_price.toFixed(2)}`:"-"})]}),t.jsxs("div",{"data-id":"fb7oysbqc","data-path":"src/components/ProductCards.tsx",children:[t.jsx("span",{className:"text-gray-500","data-id":"lo8tua9hv","data-path":"src/components/ProductCards.tsx",children:"Retail Price:"}),t.jsx("div",{className:"font-medium","data-id":"9u6yh2lg0","data-path":"src/components/ProductCards.tsx",children:s.retail_price?`$${s.retail_price.toFixed(2)}`:"-"})]}),t.jsxs("div",{"data-id":"z8oswopfk","data-path":"src/components/ProductCards.tsx",children:[t.jsx("span",{className:"text-gray-500","data-id":"64ozply7o","data-path":"src/components/ProductCards.tsx",children:"Case Price:"}),t.jsx("div",{className:"font-medium","data-id":"jy4ue1prr","data-path":"src/components/ProductCards.tsx",children:s.case_price?`$${s.case_price.toFixed(2)}`:"-"})]}),t.jsxs("div",{"data-id":"4sl3z79p4","data-path":"src/components/ProductCards.tsx",children:[t.jsx("span",{className:"text-gray-500","data-id":"d846ca4wm","data-path":"src/components/ProductCards.tsx",children:"Profit Margin:"}),t.jsx("div",{className:"font-medium","data-id":"s7kltybae","data-path":"src/components/ProductCards.tsx",children:P?t.jsxs(z,{variant:P.variant,className:"text-xs","data-id":"st1wcyk5n","data-path":"src/components/ProductCards.tsx",children:[P.value.toFixed(1),"%"]}):"-"})]})]}),t.jsxs("div",{className:"grid grid-cols-1 gap-2 text-sm border-t pt-3","data-id":"8ughceoru","data-path":"src/components/ProductCards.tsx",children:[t.jsxs("div",{className:"flex justify-between","data-id":"o55w5fzun","data-path":"src/components/ProductCards.tsx",children:[t.jsx("span",{className:"text-gray-500","data-id":"9t7nnwi4o","data-path":"src/components/ProductCards.tsx",children:"Weight:"}),t.jsx("span",{className:"font-medium","data-id":"x66bd4ci2","data-path":"src/components/ProductCards.tsx",children:s.weight&&s.weight>0?`${s.weight} ${s.weight_unit||"lb"}`:"-"})]}),t.jsxs("div",{className:"flex justify-between","data-id":"9e15p2e4z","data-path":"src/components/ProductCards.tsx",children:[t.jsx("span",{className:"text-gray-500","data-id":"osmo02jsp","data-path":"src/components/ProductCards.tsx",children:"Supplier:"}),t.jsx("span",{className:"font-medium truncate ml-2","data-id":"pd3k5olyc","data-path":"src/components/ProductCards.tsx",children:i?w(s.supplier||"-").highlightComponent:s.supplier||"-"})]}),t.jsxs("div",{className:"flex justify-between","data-id":"o39vnn1ce","data-path":"src/components/ProductCards.tsx",children:[t.jsx("span",{className:"text-gray-500","data-id":"utyht6qtb","data-path":"src/components/ProductCards.tsx",children:"Unit per Case:"}),t.jsx("span",{className:"font-medium","data-id":"3f91uaoh8","data-path":"src/components/ProductCards.tsx",children:s.unit_per_case||"-"})]}),t.jsxs("div",{className:"flex justify-between","data-id":"161xfgys0","data-path":"src/components/ProductCards.tsx",children:[t.jsx("span",{className:"text-gray-500","data-id":"2tbhaxvf4","data-path":"src/components/ProductCards.tsx",children:"Last Updated:"}),t.jsx("span",{className:"font-medium","data-id":"o9pd996us","data-path":"src/components/ProductCards.tsx",children:u(s.last_updated_date)})]}),t.jsxs("div",{className:"flex justify-between","data-id":"bxtiv50ng","data-path":"src/components/ProductCards.tsx",children:[t.jsx("span",{className:"text-gray-500","data-id":"ikluthn8r","data-path":"src/components/ProductCards.tsx",children:"Last Shopping:"}),t.jsx("span",{className:"font-medium","data-id":"oqm9cafl6","data-path":"src/components/ProductCards.tsx",children:u(s.last_shopping_date)})]})]})]})]},s.ID)})})},oa=()=>{const c=wt(),{userProfile:i}=bt(),r=G(),[p,j]=l.useState([]),[f,u]=l.useState([]),[w,C]=l.useState(!0),[s,P]=l.useState(""),[v,q]=l.useState(0),[N,d]=l.useState(!1),[x,$]=l.useState(null),[h,mt]=l.useState(""),[Bt,gt]=l.useState(!1),[D,Pt]=l.useState(!0),[T,X]=l.useState(!1),[H,A]=l.useState(null),S=50,[O,V]=l.useState(S),J=l.useRef(null);l.useEffect(()=>{const a=setTimeout(()=>{mt(s),V(S)},300);return()=>clearTimeout(a)},[s,S]),l.useEffect(()=>{W()},[]),l.useEffect(()=>{ft()},[h,O,f]);const W=async()=>{try{C(!0);const{data:a,error:o}=await I.from("products").select("*").order("id",{ascending:!1}).limit(1e3);if(o)throw o;u(a||[])}catch(a){console.error("Error loading products:",a),k({title:"Error",description:"Failed to load products",variant:"destructive"})}finally{C(!1)}},ft=()=>{gt(!!h);let a=f;if(h){const n=h.toLowerCase().trim().split(/\s+/).filter(e=>e.length>0);a=f.filter(e=>{var _;const L=[e.product_name,e.description,e.category,e.supplier,e.department,e.bar_code_case,e.bar_code_unit,(_=e.serial_number)==null?void 0:_.toString()].join(" ").toLowerCase();return n.every(y=>L.includes(y))})}h||(a=a.sort((n,e)=>{const L=n.serial_number||0,_=e.serial_number||0;return L-_}));const o=a.slice(0,O);j(o),q(a.length),Pt(O<a.length)},Z=async a=>{console.log("handleDelete called for product ID:",a);const o=confirm("Are you sure you want to delete this product? This action cannot be undone.");if(console.log("User confirmed deletion:",o),!o){console.log("Deletion cancelled by user");return}try{console.log("Attempting to delete product with ID:",a);const{error:n}=await I.from("products").delete().eq("id",a);if(n)throw console.error("API returned error:",n),n;console.log("Product deleted successfully"),k({title:"Success",description:"Product deleted successfully"}),W()}catch(n){console.error("Error deleting product:",n),k({title:"Error",description:`Failed to delete product: ${n}`,variant:"destructive"})}},tt=async(a=null)=>{var n;console.log("handleSaveProduct called for product ID:",a);const o=a===null;A(a||-1);try{if(o){if(!confirm("Create a new product entry? This will add a new product with default values that you can edit.")){console.log("Product creation cancelled by user"),A(null);return}const{data:L}=await I.from("products").select("serial_number").order("serial_number",{ascending:!1}).limit(1),y=(((n=L==null?void 0:L[0])==null?void 0:n.serial_number)||0)+1,U={serial_number:y,product_name:`New Product ${y}`,category:"General",quantity_in_stock:0,minimum_stock:0,supplier:"",description:"Please update this product information",weight:0,weight_unit:"lb",department:"Convenience Store",merchant_id:null,bar_code_case:"",bar_code_unit:"",last_updated_date:new Date().toISOString(),last_shopping_date:null,case_price:0,unit_per_case:1,unit_price:0,retail_price:0,overdue:!1,created_by:(i==null?void 0:i.user_id)||null};console.log("Creating new product with data:",U);const{error:Q}=await I.from("products").insert([U]);if(Q)throw console.error("API returned error:",Q),Q;console.log("New product created successfully with serial:",y),k({title:"Success",description:`New product created with serial #${y}. Please edit it to add complete information.`,duration:5e3})}else{const e=p.find(U=>U.ID===a);if(!e)throw new Error("Product not found");if(!confirm(`Save updates to "${e.product_name}"? This will update the product information with current values.`)){console.log("Product update cancelled by user"),A(null);return}console.log("Updating product:",e);const _={ID:e.ID,product_name:e.product_name,category:e.category||"",quantity_in_stock:e.quantity_in_stock||0,minimum_stock:e.minimum_stock||0,supplier:e.supplier||"",description:e.description||"",serial_number:e.serial_number||0,weight:e.weight||0,weight_unit:e.weight_unit||"lb",department:e.department||"Convenience Store",merchant_id:e.merchant_id||null,bar_code_case:e.bar_code_case||"",bar_code_unit:e.bar_code_unit||"",last_updated_date:new Date().toISOString(),last_shopping_date:e.last_shopping_date||null,case_price:e.case_price||0,unit_per_case:e.unit_per_case||1,unit_price:e.unit_price||0,retail_price:e.retail_price||0,overdue:e.overdue||!1,created_by:e.created_by||(i==null?void 0:i.user_id)||null};console.log("Updating product with data:",_);const{error:y}=await I.from("products").update(_).eq("ID",e.ID);if(y)throw console.error("API returned error:",y),y;console.log("Product updated successfully with ID:",e.ID),k({title:"Success",description:`"${e.product_name}" updated successfully`,duration:3e3})}W()}catch(e){console.error("Error saving product:",e),k({title:"Error",description:`Failed to ${o?"create":"update"} product: ${e}`,variant:"destructive"})}finally{A(null)}},at=l.useCallback(()=>{T||!D||(X(!0),setTimeout(()=>{V(a=>a+S),X(!1)},300))},[T,D,S]);l.useEffect(()=>{const a=new IntersectionObserver(n=>{n[0].isIntersecting&&D&&!T&&at()},{threshold:.1,rootMargin:"100px"}),o=J.current;return o&&a.observe(o),()=>{o&&a.unobserve(o)}},[at,D,T]);const st=(a,o)=>{console.log("handleViewLogs called for:",{productId:a,productName:o}),$({id:a,name:o}),d(!0),console.log("Logs modal should now be open")},jt=()=>{if(v===0)return"";const a=Math.min(p.length,v);return h?`Showing ${a} of ${v} products matching "${h}"`:D?`Showing ${a} of ${v} products - Scroll down to load more`:`Showing all ${v} products`},R=a=>{if(!h||!a)return{keywords:[],allMatch:!1,highlightComponent:a};const o=h.toLowerCase().trim().split(/\s+/).filter(L=>L.length>0),n=a.toLowerCase(),e=o.every(L=>n.includes(L));return{keywords:o,allMatch:e,highlightComponent:t.jsx(xt,{text:a,searchTerms:o,allMatch:e,"data-id":"1wt725buf","data-path":"src/pages/Products/ProductList.tsx"})}},K=()=>{P(""),V(S)};return t.jsxs(Rt,{spacing:"lg","data-id":"btwya3lp5","data-path":"src/pages/Products/ProductList.tsx",children:[t.jsxs(ot,{"data-id":"6w9ert8jz","data-path":"src/pages/Products/ProductList.tsx",children:[t.jsx(it,{"data-id":"5m1mzk7vo","data-path":"src/pages/Products/ProductList.tsx",children:t.jsxs("div",{className:`flex items-center ${r.isMobile?"flex-col space-y-4":"justify-between"}`,"data-id":"bowlpcor5","data-path":"src/pages/Products/ProductList.tsx",children:[t.jsxs("div",{className:r.isMobile?"text-center":"","data-id":"y8tl5mqr0","data-path":"src/pages/Products/ProductList.tsx",children:[t.jsxs(nt,{className:"flex items-center space-x-2","data-id":"dv5p6okn6","data-path":"src/pages/Products/ProductList.tsx",children:[t.jsx(F,{className:"w-6 h-6","data-id":"mpvi5de9f","data-path":"src/pages/Products/ProductList.tsx"}),t.jsx("span",{"data-id":"lssx8ks5s","data-path":"src/pages/Products/ProductList.tsx",children:"Products"})]}),t.jsx(vt,{className:r.isMobile?"text-center mt-2":"","data-id":"60hg960xc","data-path":"src/pages/Products/ProductList.tsx",children:"Manage your product inventory - Search across all product fields for similar items"})]}),t.jsxs(b,{onClick:()=>c("/products/new"),className:`bg-brand-600 hover:bg-brand-700 text-white ${r.isMobile?"w-full":""}`,"data-id":"yrss8uwf7","data-path":"src/pages/Products/ProductList.tsx",children:[t.jsx(Tt,{className:"w-4 h-4 mr-2","data-id":"8mt4ozszr","data-path":"src/pages/Products/ProductList.tsx"}),"Add Product"]})]})}),t.jsxs(lt,{"data-id":"cgvu9f3kp","data-path":"src/pages/Products/ProductList.tsx",children:[t.jsxs("div",{className:`flex items-center mb-6 ${r.isMobile?"flex-col space-y-3":"space-x-2"}`,"data-id":"xhu140fsq","data-path":"src/pages/Products/ProductList.tsx",children:[t.jsxs("div",{className:`relative ${r.isMobile?"w-full":"flex-1 max-w-sm"}`,"data-id":"obkwojs7a","data-path":"src/pages/Products/ProductList.tsx",children:[t.jsx(It,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4","data-id":"i4u0f0oyn","data-path":"src/pages/Products/ProductList.tsx"}),s&&t.jsx("button",{onClick:K,className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 w-4 h-4 flex items-center justify-center",title:"Clear search","data-id":"dkfof42co","data-path":"src/pages/Products/ProductList.tsx",children:t.jsx(Lt,{className:"w-4 h-4","data-id":"umphay4wr","data-path":"src/pages/Products/ProductList.tsx"})}),t.jsx(yt,{placeholder:r.isMobile?"Search products...":"Search products by name, description, category, supplier, barcode...",value:s,onChange:a=>P(a.target.value),className:`pl-10 ${s?"pr-10":"pr-3"}`,"data-id":"fokk0lrml","data-path":"src/pages/Products/ProductList.tsx"})]}),h&&t.jsxs("div",{className:`flex items-center space-x-2 ${r.isMobile?"w-full justify-center":""}`,"data-id":"vhlhajtb4","data-path":"src/pages/Products/ProductList.tsx",children:[t.jsxs(z,{variant:"secondary","data-id":"lx9c47e6v","data-path":"src/pages/Products/ProductList.tsx",children:[v," result",v!==1?"s":""," found"]}),t.jsx(b,{variant:"outline",size:"sm",onClick:K,"data-id":"0gw3ch1r5","data-path":"src/pages/Products/ProductList.tsx",children:"Clear"})]})]}),w?t.jsx("div",{className:"space-y-4","data-id":"sizuuqbx0","data-path":"src/pages/Products/ProductList.tsx",children:[...Array(5)].map((a,o)=>t.jsx("div",{className:`bg-gray-100 rounded animate-pulse ${r.isMobile?"h-32":"h-16"}`,"data-id":"iu3nnrhc1","data-path":"src/pages/Products/ProductList.tsx"},o))}):p.length===0?t.jsxs("div",{className:"text-center py-8","data-id":"5to45rrj4","data-path":"src/pages/Products/ProductList.tsx",children:[t.jsx(F,{className:"w-12 h-12 text-gray-400 mx-auto mb-4","data-id":"1pfqp05jo","data-path":"src/pages/Products/ProductList.tsx"}),t.jsx("p",{className:"text-gray-500","data-id":"pdsgjn99d","data-path":"src/pages/Products/ProductList.tsx",children:h?`No products found matching "${h}"`:"No products found"}),t.jsx(b,{variant:"outline",className:"mt-4",onClick:()=>h?K():c("/products/new"),"data-id":"81ceuepen","data-path":"src/pages/Products/ProductList.tsx",children:h?"Clear Search":"Add Your First Product"})]}):r.isMobile?t.jsx(Ut,{products:p,searchTerm:h,onViewLogs:st,onSaveProduct:tt,onDeleteProduct:Z,savingProductId:H,"data-id":"rxz6bntu1","data-path":"src/pages/Products/ProductList.tsx"}):t.jsx(At,{className:"border rounded-lg overflow-hidden","data-id":"9u668xl6m","data-path":"src/pages/Products/ProductList.tsx",children:t.jsxs(et,{"data-id":"parxcetjj","data-path":"src/pages/Products/ProductList.tsx",children:[t.jsx(rt,{"data-id":"sywj330th","data-path":"src/pages/Products/ProductList.tsx",children:t.jsxs(B,{"data-id":"reg1nxz9g","data-path":"src/pages/Products/ProductList.tsx",children:[t.jsx(m,{"data-id":"wr0rdxj7u","data-path":"src/pages/Products/ProductList.tsx",children:"Serial"}),t.jsx(m,{"data-id":"xguj479aq","data-path":"src/pages/Products/ProductList.tsx",children:"Product Name"}),t.jsx(m,{"data-id":"7h0kv6j17","data-path":"src/pages/Products/ProductList.tsx",children:"Weight"}),t.jsx(m,{"data-id":"m0mjuvv7q","data-path":"src/pages/Products/ProductList.tsx",children:"Department"}),t.jsx(m,{"data-id":"y38xdhyn7","data-path":"src/pages/Products/ProductList.tsx",children:"Merchant"}),t.jsx(m,{"data-id":"hyjsoza3w","data-path":"src/pages/Products/ProductList.tsx",children:"Last Updated Date"}),t.jsx(m,{"data-id":"035hbg930","data-path":"src/pages/Products/ProductList.tsx",children:"Last Shopping Date"}),t.jsx(m,{"data-id":"th1z3z9u8","data-path":"src/pages/Products/ProductList.tsx",children:"Case Price"}),t.jsx(m,{"data-id":"238n5lgcq","data-path":"src/pages/Products/ProductList.tsx",children:"Unit Per Case"}),t.jsx(m,{"data-id":"1z9kj96eq","data-path":"src/pages/Products/ProductList.tsx",children:"Unit Price"}),t.jsx(m,{"data-id":"yhlio4zkh","data-path":"src/pages/Products/ProductList.tsx",children:"Retail Price"}),t.jsx(m,{"data-id":"uqhntcdih","data-path":"src/pages/Products/ProductList.tsx",children:"Profit Margin"}),t.jsx(m,{"data-id":"bezh8xz0h","data-path":"src/pages/Products/ProductList.tsx",children:"Actions"})]})}),t.jsx(dt,{"data-id":"tku466zwk","data-path":"src/pages/Products/ProductList.tsx",children:p.map(a=>{const o=n=>{if(!n)return"-";try{return new Date(n).toLocaleDateString()}catch{return"-"}};return t.jsxs(B,{"data-id":"v193smj46","data-path":"src/pages/Products/ProductList.tsx",children:[t.jsx(g,{className:"font-medium","data-id":"sdowsi684","data-path":"src/pages/Products/ProductList.tsx",children:a.serial_number||"-"}),t.jsx(g,{"data-id":"e8rd7c27x","data-path":"src/pages/Products/ProductList.tsx",children:t.jsxs("div",{"data-id":"rg0lp6ej4","data-path":"src/pages/Products/ProductList.tsx",children:[t.jsx("p",{className:"font-medium","data-id":"gwy9p1va6","data-path":"src/pages/Products/ProductList.tsx",children:h?R(a.product_name).highlightComponent:a.product_name}),a.description&&t.jsx("p",{className:"text-sm text-gray-500 truncate max-w-xs","data-id":"hgubcoamt","data-path":"src/pages/Products/ProductList.tsx",children:h?R(a.description).highlightComponent:a.description})]})}),t.jsx(g,{"data-id":"6ktazokh3","data-path":"src/pages/Products/ProductList.tsx",children:a.weight&&a.weight>0?`${a.weight} ${a.weight_unit||"lb"}`:"-"}),t.jsx(g,{"data-id":"jzswq8w77","data-path":"src/pages/Products/ProductList.tsx",children:t.jsx(z,{variant:"outline","data-id":"hon8kpyv4","data-path":"src/pages/Products/ProductList.tsx",children:h?R(a.department||"Convenience Store").highlightComponent:a.department||"Convenience Store"})}),t.jsx(g,{"data-id":"tja925sjn","data-path":"src/pages/Products/ProductList.tsx",children:h?R(a.supplier||"-").highlightComponent:a.supplier||"-"}),t.jsx(g,{"data-id":"2ed5zq0bu","data-path":"src/pages/Products/ProductList.tsx",children:o(a.last_updated_date)}),t.jsx(g,{"data-id":"ilzlzxc8k","data-path":"src/pages/Products/ProductList.tsx",children:o(a.last_shopping_date)}),t.jsx(g,{"data-id":"h9o5wgj8v","data-path":"src/pages/Products/ProductList.tsx",children:a.case_price?`$${a.case_price.toFixed(2)}`:"-"}),t.jsx(g,{"data-id":"de1cqfqco","data-path":"src/pages/Products/ProductList.tsx",children:a.unit_per_case||"-"}),t.jsx(g,{"data-id":"8xxfe4zj9","data-path":"src/pages/Products/ProductList.tsx",children:a.unit_price?`$${a.unit_price.toFixed(2)}`:"-"}),t.jsx(g,{"data-id":"gvcfe406h","data-path":"src/pages/Products/ProductList.tsx",children:a.retail_price?`$${a.retail_price.toFixed(2)}`:"-"}),t.jsx(g,{"data-id":"7pq6gl3td","data-path":"src/pages/Products/ProductList.tsx",children:(()=>{if(a.unit_price&&a.retail_price&&a.retail_price>0){const n=(a.retail_price-a.unit_price)/a.retail_price*100;return t.jsxs(z,{variant:n>20?"default":n>10?"secondary":"destructive",className:"text-xs","data-id":"93py8n7ws","data-path":"src/pages/Products/ProductList.tsx",children:[n.toFixed(1),"%"]})}return"-"})()}),t.jsx(g,{"data-id":"l9c1abv6q","data-path":"src/pages/Products/ProductList.tsx",children:t.jsxs("div",{className:"flex items-center space-x-2","data-id":"wu5kfr14z","data-path":"src/pages/Products/ProductList.tsx",children:[t.jsx(b,{variant:"outline",size:"sm",onClick:()=>{console.log("Viewing logs for product:",a.ID,a.product_name),st(a.ID,a.product_name)},title:"View change logs","data-id":"1gq3ylslg","data-path":"src/pages/Products/ProductList.tsx",children:t.jsx(pt,{className:"w-4 h-4","data-id":"coqqs1v3x","data-path":"src/pages/Products/ProductList.tsx"})}),t.jsx(b,{variant:"outline",size:"sm",onClick:()=>{console.log("Saving product:",a.ID),tt(a.ID)},disabled:H===a.ID,title:"Save product","data-id":"d6aiaoqcp","data-path":"src/pages/Products/ProductList.tsx",children:H===a.ID?t.jsx(Y,{className:"w-4 h-4 animate-spin","data-id":"86whprmfp","data-path":"src/pages/Products/ProductList.tsx"}):t.jsx(ut,{className:"w-4 h-4","data-id":"lkm8ei34z","data-path":"src/pages/Products/ProductList.tsx"})}),t.jsx(b,{variant:"outline",size:"sm",onClick:()=>{console.log("Deleting product:",a.ID),Z(a.ID)},className:"text-red-600 hover:text-red-700",title:"Delete product","data-id":"8q1xzfud0","data-path":"src/pages/Products/ProductList.tsx",children:t.jsx(ht,{className:"w-4 h-4","data-id":"k497aogsp","data-path":"src/pages/Products/ProductList.tsx"})})]})})]},a.ID)})})]})}),p.length>0&&t.jsxs("div",{className:"mt-6","data-id":"m4aa6rld5","data-path":"src/pages/Products/ProductList.tsx",children:[t.jsx("p",{className:"text-sm text-gray-700 text-center mb-4","data-id":"er7e69bp3","data-path":"src/pages/Products/ProductList.tsx",children:jt()}),D&&t.jsx("div",{ref:J,className:"flex items-center justify-center py-8","data-id":"hkg96gs2v","data-path":"src/pages/Products/ProductList.tsx",children:T?t.jsxs("div",{className:"flex items-center space-x-2 text-gray-500","data-id":"9u8xoflva","data-path":"src/pages/Products/ProductList.tsx",children:[t.jsx(Y,{className:"w-5 h-5 animate-spin","data-id":"kbxlmbr8a","data-path":"src/pages/Products/ProductList.tsx"}),t.jsx("span",{"data-id":"vi9t8n6nh","data-path":"src/pages/Products/ProductList.tsx",children:"Loading more products..."})]}):t.jsx("div",{className:"text-gray-400 text-sm","data-id":"agnv83oox","data-path":"src/pages/Products/ProductList.tsx",children:"Scroll down to load more products"})}),!D&&v>S&&t.jsxs("div",{className:"text-center py-4 text-sm text-gray-500","data-id":"txy8dbwem","data-path":"src/pages/Products/ProductList.tsx",children:["You've reached the end - all ",v," products loaded"]})]})]})]}),x&&t.jsx(Et,{isOpen:N,onClose:()=>{d(!1),$(null)},productId:x.id,productName:x.name,"data-id":"ec6cb0czv","data-path":"src/pages/Products/ProductList.tsx"})]})};export{oa as default};
//# sourceMappingURL=ProductList-BPpyvonA.js.map
