import{r as n,u as R,a as $,j as e}from"./react-vendor-BIZaP1tt.js";import{s as m,K as o,C as V,d as G,e as H,f as J,B as F,g as K,L as c,I as x,S as y,h as f,i as _,j as v,k as b}from"./admin-core-CjF3pqT2.js";import{E as X}from"./business-pages-hHnmYKaj.js";import{a4 as Y,J as Q,bN as D,aG as W}from"./ui-components-Ace1hSxE.js";import"./vendor-DfVw5h9R.js";import"./aws-sdk-n3W_cRwv.js";import"./supabase-D_JhUDtQ.js";import"./admin-security-BPtF1WcO.js";import"./animations-DAkIp-yZ.js";const ne=()=>{const[t,g]=n.useState({license_name:"",license_number:"",issuing_authority:"",issue_date:"",expiry_date:"",station:"",category:"",status:"Active",document_file_id:0}),[w,h]=n.useState(!1),[l,k]=n.useState(!1),[d,I]=n.useState(null),[N,S]=n.useState(!1),L=R(),{id:p}=$(),q=["MOBIL","AMOCO ROSEDALE","AMOCO BROOKLYN","ALL"],O=["Business","Environmental","Safety","Health","Fire","Building","Other"],A=["Active","Expired","Pending Renewal"];n.useEffect(()=>{p&&(k(!0),T(parseInt(p)))},[p]);const T=async s=>{try{h(!0);const{data:a,error:i}=await m.from("licenses_certificates").select("*").eq("ID",s).single();if(i)throw i;a&&g({license_name:a.license_name||"",license_number:a.license_number||"",issuing_authority:a.issuing_authority||"",issue_date:a.issue_date?a.issue_date.split("T")[0]:"",expiry_date:a.expiry_date?a.expiry_date.split("T")[0]:"",station:a.station||"",category:a.category||"",status:a.status||"Active",document_file_id:a.document_file_id||0})}catch(a){console.error("Error loading license:",a),o({title:"Error",description:"Failed to load license details",variant:"destructive"})}finally{h(!1)}},B=async s=>{try{S(!0);const a=s.name.split(".").pop(),i=`${Date.now()}_${Math.random().toString(36).substring(2)}.${a}`,{data:u,error:C}=await m.storage.from("documents").upload(i,s);if(C)throw C;const{data:M,error:E}=await m.from("files").insert({filename:s.name,storage_path:u.path,file_size:s.size,mime_type:s.type,uploaded_at:new Date().toISOString()}).select("id").single();if(E)throw E;g(P=>({...P,document_file_id:M.id})),I(s),o({title:"Success",description:"File uploaded successfully"})}catch(a){console.error("Error uploading file:",a),o({title:"Error",description:"Failed to upload file",variant:"destructive"})}finally{S(!1)}},U=async s=>{s.preventDefault();try{h(!0);const a={...t,issue_date:t.issue_date?new Date(t.issue_date).toISOString():"",expiry_date:t.expiry_date?new Date(t.expiry_date).toISOString():"",created_by:1};if(l&&p){const{error:i}=await m.from("licenses_certificates").update(a).eq("ID",parseInt(p));if(i)throw i;o({title:"Success",description:"License updated successfully"})}else{const{error:i}=await m.from("licenses_certificates").insert(a);if(i)throw i;o({title:"Success",description:"License created successfully"})}L("/licenses")}catch(a){console.error("Error saving license:",a),o({title:"Error",description:`Failed to ${l?"update":"create"} license`,variant:"destructive"})}finally{h(!1)}},r=(s,a)=>{g(i=>({...i,[s]:a}))},z=s=>{if(!s)return!1;const a=new Date,i=new Date(s),u=Math.ceil((i.getTime()-a.getTime())/(1e3*3600*24));return u<=30&&u>=0},j=s=>{if(!s)return!1;const a=new Date;return new Date(s)<a};return e.jsx("div",{className:"space-y-6","data-id":"vgg3ndeg1","data-path":"src/pages/Licenses/LicenseForm.tsx",children:e.jsxs(V,{"data-id":"whv4ybpk8","data-path":"src/pages/Licenses/LicenseForm.tsx",children:[e.jsx(G,{"data-id":"rdvlhb424","data-path":"src/pages/Licenses/LicenseForm.tsx",children:e.jsxs("div",{className:"flex items-center justify-between","data-id":"bdkxse7nv","data-path":"src/pages/Licenses/LicenseForm.tsx",children:[e.jsxs("div",{"data-id":"7guhb7pso","data-path":"src/pages/Licenses/LicenseForm.tsx",children:[e.jsxs(H,{className:"flex items-center space-x-2","data-id":"yh5a4rrrj","data-path":"src/pages/Licenses/LicenseForm.tsx",children:[e.jsx(Y,{className:"w-6 h-6","data-id":"r4ipenl0f","data-path":"src/pages/Licenses/LicenseForm.tsx"}),e.jsx("span",{"data-id":"zkdvbz5ak","data-path":"src/pages/Licenses/LicenseForm.tsx",children:l?"Edit License":"Add New License"})]}),e.jsx(J,{"data-id":"trqxlb7gg","data-path":"src/pages/Licenses/LicenseForm.tsx",children:l?"Update license information":"Add a new license or certificate"})]}),e.jsxs(F,{variant:"outline",onClick:()=>L("/licenses"),"data-id":"stld9a5oy","data-path":"src/pages/Licenses/LicenseForm.tsx",children:[e.jsx(Q,{className:"w-4 h-4 mr-2","data-id":"ckut7gfpu","data-path":"src/pages/Licenses/LicenseForm.tsx"}),"Back to Licenses"]})]})}),e.jsx(K,{"data-id":"i7jln73oz","data-path":"src/pages/Licenses/LicenseForm.tsx",children:e.jsxs("form",{onSubmit:U,className:"space-y-6","data-id":"qb6ele6zj","data-path":"src/pages/Licenses/LicenseForm.tsx",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6","data-id":"zh2x4y67u","data-path":"src/pages/Licenses/LicenseForm.tsx",children:[e.jsxs("div",{className:"space-y-2","data-id":"hj9j5f1s3","data-path":"src/pages/Licenses/LicenseForm.tsx",children:[e.jsx(c,{htmlFor:"license_name","data-id":"ya65wvg7z","data-path":"src/pages/Licenses/LicenseForm.tsx",children:"License Name *"}),e.jsx(x,{id:"license_name",value:t.license_name,onChange:s=>r("license_name",s.target.value),placeholder:"Enter license name",required:!0,"data-id":"fdgizepaj","data-path":"src/pages/Licenses/LicenseForm.tsx"})]}),e.jsxs("div",{className:"space-y-2","data-id":"yjjalfvhz","data-path":"src/pages/Licenses/LicenseForm.tsx",children:[e.jsx(c,{htmlFor:"license_number","data-id":"s15js82rs","data-path":"src/pages/Licenses/LicenseForm.tsx",children:"License Number *"}),e.jsx(x,{id:"license_number",value:t.license_number,onChange:s=>r("license_number",s.target.value),placeholder:"Enter license number",required:!0,"data-id":"ocvbgxszl","data-path":"src/pages/Licenses/LicenseForm.tsx"})]}),e.jsxs("div",{className:"space-y-2","data-id":"0wb0i8xza","data-path":"src/pages/Licenses/LicenseForm.tsx",children:[e.jsx(c,{htmlFor:"issuing_authority","data-id":"e38j05y21","data-path":"src/pages/Licenses/LicenseForm.tsx",children:"Issuing Authority *"}),e.jsx(x,{id:"issuing_authority",value:t.issuing_authority,onChange:s=>r("issuing_authority",s.target.value),placeholder:"Enter issuing authority",required:!0,"data-id":"3a14tkjai","data-path":"src/pages/Licenses/LicenseForm.tsx"})]}),e.jsxs("div",{className:"space-y-2","data-id":"6burj9om8","data-path":"src/pages/Licenses/LicenseForm.tsx",children:[e.jsx(c,{htmlFor:"category","data-id":"do1gats5a","data-path":"src/pages/Licenses/LicenseForm.tsx",children:"Category *"}),e.jsxs(y,{value:t.category,onValueChange:s=>r("category",s),"data-id":"rk38ofbfb","data-path":"src/pages/Licenses/LicenseForm.tsx",children:[e.jsx(f,{"data-id":"hy4ju1948","data-path":"src/pages/Licenses/LicenseForm.tsx",children:e.jsx(_,{placeholder:"Select category","data-id":"zxkwx0flw","data-path":"src/pages/Licenses/LicenseForm.tsx"})}),e.jsx(v,{"data-id":"fv1mi1fib","data-path":"src/pages/Licenses/LicenseForm.tsx",children:O.map(s=>e.jsx(b,{value:s,"data-id":"kpla2neio","data-path":"src/pages/Licenses/LicenseForm.tsx",children:s},s))})]})]}),e.jsxs("div",{className:"space-y-2","data-id":"busal6z6k","data-path":"src/pages/Licenses/LicenseForm.tsx",children:[e.jsx(c,{htmlFor:"station","data-id":"5udd3b4lb","data-path":"src/pages/Licenses/LicenseForm.tsx",children:"Station *"}),e.jsxs(y,{value:t.station,onValueChange:s=>r("station",s),"data-id":"6pjebtuu9","data-path":"src/pages/Licenses/LicenseForm.tsx",children:[e.jsx(f,{"data-id":"s74be2uy5","data-path":"src/pages/Licenses/LicenseForm.tsx",children:e.jsx(_,{placeholder:"Select station","data-id":"s4axje0sb","data-path":"src/pages/Licenses/LicenseForm.tsx"})}),e.jsx(v,{"data-id":"33znbhlxs","data-path":"src/pages/Licenses/LicenseForm.tsx",children:q.map(s=>e.jsx(b,{value:s,"data-id":"9tgssdbk3","data-path":"src/pages/Licenses/LicenseForm.tsx",children:s},s))})]})]}),e.jsxs("div",{className:"space-y-2","data-id":"gzgg7u0pa","data-path":"src/pages/Licenses/LicenseForm.tsx",children:[e.jsx(c,{htmlFor:"status","data-id":"fl8r90u2e","data-path":"src/pages/Licenses/LicenseForm.tsx",children:"Status"}),e.jsxs(y,{value:t.status,onValueChange:s=>r("status",s),"data-id":"d7dyjp36w","data-path":"src/pages/Licenses/LicenseForm.tsx",children:[e.jsx(f,{"data-id":"drilkptry","data-path":"src/pages/Licenses/LicenseForm.tsx",children:e.jsx(_,{placeholder:"Select status","data-id":"ybt1dbg8q","data-path":"src/pages/Licenses/LicenseForm.tsx"})}),e.jsx(v,{"data-id":"mnyxyvhfk","data-path":"src/pages/Licenses/LicenseForm.tsx",children:A.map(s=>e.jsx(b,{value:s,"data-id":"07s2mz23o","data-path":"src/pages/Licenses/LicenseForm.tsx",children:s},s))})]})]}),e.jsxs("div",{className:"space-y-2","data-id":"1337o29xp","data-path":"src/pages/Licenses/LicenseForm.tsx",children:[e.jsx(c,{htmlFor:"issue_date","data-id":"8d35k0u62","data-path":"src/pages/Licenses/LicenseForm.tsx",children:"Issue Date"}),e.jsx(x,{id:"issue_date",type:"date",value:t.issue_date,onChange:s=>r("issue_date",s.target.value),"data-id":"jgbp0zhl1","data-path":"src/pages/Licenses/LicenseForm.tsx"})]}),e.jsxs("div",{className:"space-y-2","data-id":"0r75wchg8","data-path":"src/pages/Licenses/LicenseForm.tsx",children:[e.jsx(c,{htmlFor:"expiry_date","data-id":"civv8lqca","data-path":"src/pages/Licenses/LicenseForm.tsx",children:"Expiry Date"}),e.jsx(x,{id:"expiry_date",type:"date",value:t.expiry_date,onChange:s=>r("expiry_date",s.target.value),className:j(t.expiry_date)?"border-red-500":z(t.expiry_date)?"border-yellow-500":"","data-id":"x8dq4e6sc","data-path":"src/pages/Licenses/LicenseForm.tsx"}),j(t.expiry_date)&&e.jsx("p",{className:"text-sm text-red-600","data-id":"b9vw9vkd4","data-path":"src/pages/Licenses/LicenseForm.tsx",children:"⚠️ This license has expired"}),z(t.expiry_date)&&!j(t.expiry_date)&&e.jsx("p",{className:"text-sm text-yellow-600","data-id":"3b5uimmu3","data-path":"src/pages/Licenses/LicenseForm.tsx",children:"⚠️ This license expires within 30 days"})]})]}),e.jsxs("div",{className:"space-y-4","data-id":"89hdc48lr","data-path":"src/pages/Licenses/LicenseForm.tsx",children:[e.jsx(c,{"data-id":"aqxb1zuzs","data-path":"src/pages/Licenses/LicenseForm.tsx",children:"License Document"}),e.jsx(X,{onFileSelect:B,accept:".pdf,.doc,.docx,.jpg,.jpeg,.png,image/*",label:"Upload License Document or Take Photo",currentFile:(d==null?void 0:d.name)||(t.document_file_id>0?`Document ID: ${t.document_file_id}`:void 0),maxSize:10,allowCamera:!0,disabled:N,"data-id":"i2v0kpg93","data-path":"src/pages/Licenses/LicenseForm.tsx"}),d&&e.jsx("div",{className:"mt-4 p-3 bg-green-50 border border-green-200 rounded","data-id":"xr4f0yzwq","data-path":"src/pages/Licenses/LicenseForm.tsx",children:e.jsxs("div",{className:"flex items-center space-x-2","data-id":"b9b0h0jke","data-path":"src/pages/Licenses/LicenseForm.tsx",children:[e.jsx(D,{className:"w-4 h-4 text-green-600","data-id":"f94p8mdpt","data-path":"src/pages/Licenses/LicenseForm.tsx"}),e.jsxs("span",{className:"text-sm text-green-800","data-id":"z2otnvgur","data-path":"src/pages/Licenses/LicenseForm.tsx",children:["Recently uploaded: ",d.name]})]})}),t.document_file_id>0&&!d&&e.jsx("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded","data-id":"gecz4f6n3","data-path":"src/pages/Licenses/LicenseForm.tsx",children:e.jsxs("div",{className:"flex items-center space-x-2","data-id":"54u6wzjry","data-path":"src/pages/Licenses/LicenseForm.tsx",children:[e.jsx(D,{className:"w-4 h-4 text-blue-600","data-id":"r7zxszcvg","data-path":"src/pages/Licenses/LicenseForm.tsx"}),e.jsxs("span",{className:"text-sm text-blue-800","data-id":"o5r2lp8wl","data-path":"src/pages/Licenses/LicenseForm.tsx",children:["Document uploaded (ID: ",t.document_file_id,")"]})]})}),e.jsx("p",{className:"text-sm text-gray-500","data-id":"ch3s3xq6h","data-path":"src/pages/Licenses/LicenseForm.tsx",children:"PDF, DOC, DOCX, JPG, PNG files up to 10MB"})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-4","data-id":"o021vxd1d","data-path":"src/pages/Licenses/LicenseForm.tsx",children:[e.jsx(F,{type:"button",variant:"outline",onClick:()=>L("/licenses"),"data-id":"hxu85hw1b","data-path":"src/pages/Licenses/LicenseForm.tsx",children:"Cancel"}),e.jsx(F,{type:"submit",disabled:w||N,"data-id":"ssskqblmb","data-path":"src/pages/Licenses/LicenseForm.tsx",children:w?"Saving...":e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"w-4 h-4 mr-2","data-id":"9kdwsj9av","data-path":"src/pages/Licenses/LicenseForm.tsx"}),l?"Update License":"Create License"]})})]})]})})]})})};export{ne as default};
