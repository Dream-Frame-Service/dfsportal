import{j as e}from"./ui-D8yO-OxE.js";import{r as p}from"./vendor-XhsmhKu1.js";import{c as V,u as Y,B as u,C as b,f as C,h as _,X as H}from"./index-DRBMqcxT.js";import{D as ee,f as ae,a as te,b as se,c as ne}from"./dialog--irBdw-G.js";import{U as oe,C as T}from"./textarea-B-Q9Uetu.js";import{L as ce}from"./loader-2-_jRFAYkw.js";import{Z as ie}from"./zap-HGA0vdNu.js";import{C as de}from"./select-D0pEHiDr.js";import{R as re}from"./rotate-ccw-DV9cG8Qf.js";import{F as le}from"./file-text-Btezo_YE.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=V("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),S=a=>a.type.startsWith("image/"),P=a=>{if(a===0)return"0 Bytes";const t=1024,n=["Bytes","KB","MB","GB"],o=Math.floor(Math.log(a)/Math.log(t));return`${parseFloat((a/Math.pow(t,o)).toFixed(2))} ${n[o]}`},me=(a,t)=>{const n=document.createElement("canvas");return n.width=a,n.height=t,n},he=(a,t,n)=>{if(!n||a<=n&&t<=n)return{width:a,height:t};const o=a/t;return a>t?{width:n,height:Math.round(n/o)}:{width:Math.round(n*o),height:n}},xe=a=>new Promise((t,n)=>{const o=new Image;o.onload=()=>t(o),o.onerror=()=>n(new Error("Failed to load image")),o.src=URL.createObjectURL(a)}),ue=(a,t)=>new Promise((n,o)=>{const{width:c,height:l}=he(a.naturalWidth,a.naturalHeight,t.maxWidthOrHeight),m=me(c,l),h=m.getContext("2d");if(!h){o(new Error("Could not get canvas context"));return}h.imageSmoothingEnabled=!0,h.imageSmoothingQuality="high",h.drawImage(a,0,0,c,l),m.toBlob(r=>{r?n(r):o(new Error("Failed to compress image"))},"image/jpeg",t.quality||.8)}),ge=async(a,t,n)=>{let o=n.initialQuality||.8,c,l=0;const m=10,h=t*1024*1024;do{if(c=await ue(a,{...n,quality:o}),c.size<=h||l>=m)break;o=Math.max(.1,o-.1),l++}while(l<m);return c},fe=()=>{try{const a=localStorage.getItem("imageCompressionSettings");if(a){const t=JSON.parse(a);return{maxSizeMB:t.maxSizeMB||1,maxWidthOrHeight:t.maxResolution||1920,quality:t.quality||.8,initialQuality:t.quality||.8,useWebWorker:!1,alwaysKeepResolution:!1}}}catch(a){console.error("Failed to load compression settings:",a)}return{maxSizeMB:1,maxWidthOrHeight:1920,quality:.8,initialQuality:.8,useWebWorker:!1,alwaysKeepResolution:!1}},je=()=>{try{const a=localStorage.getItem("imageCompressionSettings");if(a)return JSON.parse(a).enabled!==!1}catch(a){console.error("Failed to load compression settings:",a)}return!0},Fe=async(a,t)=>{const o={...fe(),...t},c=a.size,l=o.maxSizeMB,m=l*1024*1024;if(!je())return{file:a,originalSize:c,compressedSize:c,compressionRatio:1,wasCompressed:!1};if(!S(a))return{file:a,originalSize:c,compressedSize:c,compressionRatio:1,wasCompressed:!1};if(!(()=>{try{const r=localStorage.getItem("imageCompressionSettings");return r?JSON.parse(r).autoCompress:!1}catch{return!1}})()&&c<=m)return{file:a,originalSize:c,compressedSize:c,compressionRatio:1,wasCompressed:!1};try{const r=await xe(a),g=await ge(r,l,o),y=new File([g],a.name.replace(/\.[^/.]+$/,".jpg"),{type:"image/jpeg",lastModified:Date.now()}),j=y.size,U=c/j;return URL.revokeObjectURL(r.src),{file:y,originalSize:c,compressedSize:j,compressionRatio:U,wasCompressed:!0}}catch(r){return console.error("Image compression failed:",r),{file:a,originalSize:c,compressedSize:c,compressionRatio:1,wasCompressed:!1}}},Re=({onFileSelect:a,accept:t="image/*",label:n="Upload File",currentFile:o,maxSize:c=10,className:l="",disabled:m=!1,allowCamera:h=!0})=>{const[r,g]=p.useState(!1),[y,j]=p.useState(!1),[U,k]=p.useState(null),[v,N]=p.useState(null),[R,I]=p.useState(!1),[$,B]=p.useState(!1),[we,O]=p.useState(null),E=p.useRef(null),F=p.useRef(null),w=p.useRef(null),{toast:f}=Y(),q=t.includes("image"),A=h&&q,M=s=>s.size>c*1024*1024?(f({title:"File too large",description:`File size must be less than ${c}MB`,variant:"destructive"}),!1):t&&t!=="*/*"&&!t.split(",").map(x=>x.trim()).some(x=>{if(x.startsWith("."))return s.name.toLowerCase().endsWith(x.toLowerCase());if(x.includes("*")){const X=x.split("/")[0];return s.type.startsWith(X)}else return s.type===x})?(f({title:"Invalid file type",description:`Please select a file of type: ${t}`,variant:"destructive"}),!1):!0,L=async s=>{if(S(s)&&s.size>1048576){B(!0);try{const i=await Fe(s,{maxSizeMB:1,maxWidthOrHeight:1920,quality:.8,initialQuality:.8});O(i),i.wasCompressed&&f({title:"Image compressed",description:`File size reduced from ${P(i.originalSize)} to ${P(i.compressedSize)} (${i.compressionRatio.toFixed(1)}x smaller)`,duration:5e3}),a(i.file),g(!1)}catch(i){console.error("Compression failed:",i),f({title:"Compression failed",description:"Using original file instead",variant:"destructive"}),a(s),g(!1)}finally{B(!1)}}else a(s),g(!1),f({title:"File selected",description:`${s.name} has been selected successfully`})},W=async s=>{var i;const d=(i=s.target.files)==null?void 0:i[0];d&&M(d)&&await L(d),E.current&&(E.current.value="")},Q=async()=>{I(!0);try{const s=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:1920},height:{ideal:1080},facingMode:"environment"}});k(s),j(!0),F.current&&(F.current.srcObject=s)}catch(s){console.error("Error accessing camera:",s),f({title:"Camera access denied",description:"Please allow camera access to take photos",variant:"destructive"})}finally{I(!1)}},z=()=>{U&&(U.getTracks().forEach(s=>s.stop()),k(null)),j(!1),N(null)},J=()=>{if(F.current&&w.current){const s=F.current,d=w.current,i=d.getContext("2d");if(i){d.width=s.videoWidth,d.height=s.videoHeight,i.drawImage(s,0,0);const x=d.toDataURL("image/jpeg",.8);N(x)}}},K=async()=>{v&&w.current&&w.current.toBlob(async s=>{if(s){const d=new File([s],`captured-${Date.now()}.jpg`,{type:"image/jpeg"});M(d)&&(z(),await L(d),f({title:"Photo captured",description:"Photo has been captured successfully"}))}},"image/jpeg",.8)},Z=()=>{N(null)},G=()=>{z(),g(!1)},D=()=>q?e.jsx(pe,{className:"h-4 w-4","data-id":"s00ni63sv","data-path":"src/components/EnhancedFileUpload.tsx"}):e.jsx(le,{className:"h-4 w-4","data-id":"qshbpzxgb","data-path":"src/components/EnhancedFileUpload.tsx"});return e.jsxs("div",{className:l,"data-id":"28a897lqr","data-path":"src/components/EnhancedFileUpload.tsx",children:[e.jsxs(ee,{open:r,onOpenChange:g,"data-id":"bepxqjckf","data-path":"src/components/EnhancedFileUpload.tsx",children:[e.jsx(ae,{asChild:!0,"data-id":"z3faij0d2","data-path":"src/components/EnhancedFileUpload.tsx",children:e.jsxs(u,{variant:"outline",disabled:m,className:"w-full flex items-center gap-2","data-id":"t1rspq6qi","data-path":"src/components/EnhancedFileUpload.tsx",children:[D(),n]})}),e.jsxs(te,{className:"max-w-2xl max-h-[90vh] overflow-y-auto","data-id":"9mn6e0kph","data-path":"src/components/EnhancedFileUpload.tsx",children:[e.jsx(se,{"data-id":"bt6bnsl33","data-path":"src/components/EnhancedFileUpload.tsx",children:e.jsxs(ne,{className:"flex items-center gap-2","data-id":"t8cim5qfq","data-path":"src/components/EnhancedFileUpload.tsx",children:[D(),n]})}),y?e.jsxs("div",{className:"space-y-4","data-id":"e9h50j0qb","data-path":"src/components/EnhancedFileUpload.tsx",children:[e.jsxs("div",{className:"flex items-center justify-between","data-id":"yjfg4olcu","data-path":"src/components/EnhancedFileUpload.tsx",children:[e.jsx("h3",{className:"text-lg font-semibold","data-id":"wavuww0ah","data-path":"src/components/EnhancedFileUpload.tsx",children:"Camera"}),e.jsx(u,{variant:"ghost",size:"sm",onClick:G,"data-id":"2pefry38n","data-path":"src/components/EnhancedFileUpload.tsx",children:e.jsx(H,{className:"h-4 w-4","data-id":"4lgdm8ags","data-path":"src/components/EnhancedFileUpload.tsx"})})]}),e.jsxs("div",{className:"relative bg-black rounded-lg overflow-hidden","data-id":"l1bwqp81w","data-path":"src/components/EnhancedFileUpload.tsx",children:[v?e.jsx("img",{src:v,alt:"Captured",className:"w-full h-64 md:h-96 object-cover","data-id":"5if3pxpxy","data-path":"src/components/EnhancedFileUpload.tsx"}):e.jsx("video",{ref:F,autoPlay:!0,playsInline:!0,className:"w-full h-64 md:h-96 object-cover","data-id":"v9u3clu7c","data-path":"src/components/EnhancedFileUpload.tsx"}),e.jsx("canvas",{ref:w,className:"hidden","data-id":"tlhxi398w","data-path":"src/components/EnhancedFileUpload.tsx"})]}),e.jsx("div",{className:"flex justify-center gap-4","data-id":"6yfmmbhry","data-path":"src/components/EnhancedFileUpload.tsx",children:v?e.jsxs(e.Fragment,{children:[e.jsxs(u,{onClick:K,className:"flex items-center gap-2","data-id":"ayvxnzku1","data-path":"src/components/EnhancedFileUpload.tsx",children:[e.jsx(de,{className:"h-4 w-4","data-id":"tfsxgolu8","data-path":"src/components/EnhancedFileUpload.tsx"}),"Use This Photo"]}),e.jsxs(u,{variant:"outline",onClick:Z,className:"flex items-center gap-2","data-id":"dbatyj76m","data-path":"src/components/EnhancedFileUpload.tsx",children:[e.jsx(re,{className:"h-4 w-4","data-id":"3u9t16jif","data-path":"src/components/EnhancedFileUpload.tsx"}),"Retake"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(u,{onClick:J,className:"flex items-center gap-2","data-id":"2ei8u6uhx","data-path":"src/components/EnhancedFileUpload.tsx",children:[e.jsx(T,{className:"h-4 w-4","data-id":"gy6hdxk3j","data-path":"src/components/EnhancedFileUpload.tsx"}),"Capture"]}),e.jsx(u,{variant:"outline",onClick:z,"data-id":"18j6yyzci","data-path":"src/components/EnhancedFileUpload.tsx",children:"Cancel"})]})})]}):e.jsxs("div",{className:"space-y-4","data-id":"ajndwulj2","data-path":"src/components/EnhancedFileUpload.tsx",children:[o&&e.jsx(b,{"data-id":"6a3smxs3r","data-path":"src/components/EnhancedFileUpload.tsx",children:e.jsx(C,{className:"p-4","data-id":"pd6aksu51","data-path":"src/components/EnhancedFileUpload.tsx",children:e.jsxs("div",{className:"flex items-center justify-between","data-id":"i6hki4rpq","data-path":"src/components/EnhancedFileUpload.tsx",children:[e.jsx("span",{className:"text-sm text-gray-600","data-id":"szbtuxohh","data-path":"src/components/EnhancedFileUpload.tsx",children:"Current file:"}),e.jsx(_,{variant:"secondary","data-id":"iae45fgy2","data-path":"src/components/EnhancedFileUpload.tsx",children:o})]})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4","data-id":"r9vlqzkb6","data-path":"src/components/EnhancedFileUpload.tsx",children:[e.jsx(b,{className:"cursor-pointer hover:bg-gray-50 transition-colors","data-id":"h91w96m2g","data-path":"src/components/EnhancedFileUpload.tsx",children:e.jsx(C,{className:"p-6","data-id":"otelxb92x","data-path":"src/components/EnhancedFileUpload.tsx",children:e.jsxs(u,{variant:"ghost",className:"w-full h-auto p-0 flex flex-col items-center gap-3",onClick:()=>{var s;return(s=E.current)==null?void 0:s.click()},"data-id":"ge5fl7cm8","data-path":"src/components/EnhancedFileUpload.tsx",children:[e.jsx("div",{className:"p-4 bg-blue-100 rounded-full","data-id":"beki9ayfi","data-path":"src/components/EnhancedFileUpload.tsx",children:e.jsx(oe,{className:"h-8 w-8 text-blue-600","data-id":"uovt8mj4f","data-path":"src/components/EnhancedFileUpload.tsx"})}),e.jsxs("div",{className:"text-center","data-id":"vjfu6smw8","data-path":"src/components/EnhancedFileUpload.tsx",children:[e.jsx("h3",{className:"font-semibold","data-id":"25bza49x8","data-path":"src/components/EnhancedFileUpload.tsx",children:"Upload From File"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1","data-id":"escx2h8bs","data-path":"src/components/EnhancedFileUpload.tsx",children:"Choose a file from your device"})]})]})})}),A&&e.jsx(b,{className:"cursor-pointer hover:bg-gray-50 transition-colors","data-id":"afan0j4jm","data-path":"src/components/EnhancedFileUpload.tsx",children:e.jsx(C,{className:"p-6","data-id":"imwm0gy0s","data-path":"src/components/EnhancedFileUpload.tsx",children:e.jsxs(u,{variant:"ghost",className:"w-full h-auto p-0 flex flex-col items-center gap-3",onClick:Q,disabled:R,"data-id":"b85cnn2vi","data-path":"src/components/EnhancedFileUpload.tsx",children:[e.jsx("div",{className:"p-4 bg-green-100 rounded-full","data-id":"lnix4ai1o","data-path":"src/components/EnhancedFileUpload.tsx",children:e.jsx(T,{className:"h-8 w-8 text-green-600","data-id":"tncve2dth","data-path":"src/components/EnhancedFileUpload.tsx"})}),e.jsxs("div",{className:"text-center","data-id":"ebsr6zrgi","data-path":"src/components/EnhancedFileUpload.tsx",children:[e.jsx("h3",{className:"font-semibold","data-id":"kzmlckl5i","data-path":"src/components/EnhancedFileUpload.tsx",children:"Take A Picture"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1","data-id":"54zw6iu52","data-path":"src/components/EnhancedFileUpload.tsx",children:R?"Loading camera...":"Use your camera to capture"})]})]})})})]}),$&&e.jsx(b,{className:"border-blue-200 bg-blue-50","data-id":"orgi2knzb","data-path":"src/components/EnhancedFileUpload.tsx",children:e.jsx(C,{className:"p-4","data-id":"u3nhnobw1","data-path":"src/components/EnhancedFileUpload.tsx",children:e.jsxs("div",{className:"flex items-center gap-3","data-id":"w58roef90","data-path":"src/components/EnhancedFileUpload.tsx",children:[e.jsx(ce,{className:"h-5 w-5 animate-spin text-blue-600","data-id":"3bbqg8m6o","data-path":"src/components/EnhancedFileUpload.tsx"}),e.jsxs("div",{"data-id":"lzgckt22h","data-path":"src/components/EnhancedFileUpload.tsx",children:[e.jsx("p",{className:"font-medium text-blue-800","data-id":"jbnh98nc2","data-path":"src/components/EnhancedFileUpload.tsx",children:"Compressing image..."}),e.jsx("p",{className:"text-sm text-blue-600","data-id":"jjwtng8jt","data-path":"src/components/EnhancedFileUpload.tsx",children:"Optimizing file size for better performance"})]})]})})}),e.jsxs("div",{className:"text-center text-sm text-gray-500","data-id":"72b9ko7qb","data-path":"src/components/EnhancedFileUpload.tsx",children:[e.jsxs("p",{"data-id":"j5om62lms","data-path":"src/components/EnhancedFileUpload.tsx",children:["Accepted file types: ",t]}),e.jsxs("p",{"data-id":"frapsjolz","data-path":"src/components/EnhancedFileUpload.tsx",children:["Maximum file size: ",c,"MB"]}),S({type:t})&&e.jsx("div",{className:"mt-2 p-2 bg-green-50 rounded-lg border border-green-200","data-id":"d6e1rbnh5","data-path":"src/components/EnhancedFileUpload.tsx",children:e.jsxs("div",{className:"flex items-center justify-center gap-2 text-green-700","data-id":"58uwv7s4q","data-path":"src/components/EnhancedFileUpload.tsx",children:[e.jsx(ie,{className:"h-4 w-4","data-id":"eowz576wz","data-path":"src/components/EnhancedFileUpload.tsx"}),e.jsx("span",{className:"text-xs font-medium","data-id":"b7ml71nrw","data-path":"src/components/EnhancedFileUpload.tsx",children:"Auto-compression enabled for images >1MB"})]})})]})]})]})]}),e.jsx("input",{ref:E,type:"file",accept:t,onChange:W,className:"hidden","data-id":"y897ysif0","data-path":"src/components/EnhancedFileUpload.tsx"})]})};export{Re as E};
//# sourceMappingURL=EnhancedFileUpload-xuzDVd9Q.js.map
